<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xmlns:batch="http://www.springframework.org/schema/batch"
    xmlns:task="http://www.springframework.org/schema/task"
    xmlns:context="http://www.springframework.org/schema/context"
    xmlns:util="http://www.springframework.org/schema/util"
    xmlns:p="http://www.springframework.org/schema/p"
    xsi:schemaLocation="http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task.xsd
    http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/batch http://www.springframework.org/schema/batch/spring-batch.xsd
    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">
 
 <import resource="classpath:batchConfig.xml"/>
 
 <bean id="myDecider" class="pl.java.scalatech.decider.SkippedDecider"/>
 <bean id="registerItemsDecider" class="pl.java.scalatech.decider.RegisterItemDecider"/>
 
 
 <bean id ="startTasklet" class="pl.java.scalatech.tasklet.HelloTasklet"/>
 <bean id="stoppedTasklet" class="pl.java.scalatech.tasklet.StoppingTasklet"/> 
 <bean id="cleanTasklet" class="pl.java.scalatech.tasklet.CleanTasklet"/>
 

 <bean id="jobListener" class="pl.java.scalatech.listener.JobLoggerListener"/>
 <bean id="stepListener" class="pl.java.scalatech.listener.StepLoggingListener"/>
 <bean id="stoppedListener" class="pl.java.scalatech.listener.StoppingListener"/>
 <bean id="jobParametersIncrementer" class="org.springframework.batch.core.launch.support.RunIdIncrementer"/> 
 
 <step id="stepParent" abstract="true" xmlns="http://www.springframework.org/schema/batch">
        <tasklet>
            <chunk>
                <skippable-exception-classes>
                    <include class="java.lang.IllegalArgumentException" />
                    <include class="java.lang.NullPointerException" />
                </skippable-exception-classes>
            </chunk>
        </tasklet>
    </step>
 
  <batch:job id="stoppedTask" incrementer="jobParametersIncrementer">
        <batch:step id="startStep" next="stoppedStep">
            <tasklet ref="startTasklet"/>
        </batch:step>
        
                
        <batch:step id="stoppedStep" >
            <tasklet ref="stoppedTasklet">
               
                 <batch:listeners>
                  <batch:listener ref="stoppedListener"/>
                </batch:listeners>
            </tasklet>
            <batch:end on="NO_DATA"/>
            <batch:fail on="*"/>
            <batch:next on="DATA_EXISTS" to="cleanStep"/>
            
        </batch:step>
        
       
        <batch:step id="cleanStep">
            <tasklet ref="cleanTasklet"/>
            <batch:listeners>
              <batch:listener ref="stepListener"/>
            </batch:listeners>
        </batch:step>
        <batch:listeners>
        
          <batch:listener ref="jobListener" />
        </batch:listeners>
        
    </batch:job>
   
 </beans>
